# 什么是堆栈？它们之间的区别与联系

堆和栈的概念存在于数据结构和操作系统内存中。在数据结构中，栈的存取方式是先进后出的，而堆是一个优先队列，按优先级来进行排序。优先级可以按照大小来规定。完全二叉树就是堆的一种方式。

而在操作系统中，

栈区，是由编译器自动分配释放，存放函数的参数值、局部变量等，他的操作方式类似数据结构中的栈

堆区，是由程序员分配和释放的，如果程序员不主动释放，程序结束时会有垃圾回收机制回收

区别与联系：

1.申请方式不同

栈是由系统自动分配，如声明在函数中一个基本类型变量，系统将会在栈中分配一块空间

堆是需要程序员自己申请并指明大小

2.申请后系统的响应

对于栈，只要栈的剩余空间大于所申请的空间，系统就会为程序提供内存，否则将报异常提示栈溢出

对于堆，操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点链表中删除，并且将该结点的空间分配给程序，另外，对于大多数的系统，会在这块内存空间的首地址记录本次分配的大小，这样，代码中的delete语句才能正确的释放本内存空间。另外，由于找到的堆结点的大小不一定正好等于申请的大小，系统会自动的将多余的那部分重新放入空闲链表中。

3.申请大小的限制

栈：在windows下，栈是向低地址扩展的数据结构，是一块连续的内存的区域。栈顶的地址和栈的最大容量是系统预先规定好的，在windows下，栈的大小2M，如果申请的空间超过栈的剩余空间，将提示栈溢出

堆：堆是向高地址扩展的数据结构，是不连续的内存区域，这是由于系统使用链表来存储的空间内存地址，而链表的遍历方向是由低地址向高地址。堆的大小受限于计算机系统中有效的虚拟内存

4.申请效率的比较

栈是由系统分配，速度较快，但程序员是无法控制的

堆是由new分配的内存，一般速度会比栈慢，而且容易产生内存碎片



总结：堆和栈的概念存在于数据结构中和操作系统内存中。在数据结构中，栈中数据的存取方式为 先进后出。而堆是一个优先队列，是按优先级来进行排序的，优先级可以按照大小来规定。完全 二叉树是堆的一种实现方式。在操作系统中，内存被分为栈区和堆区。栈区内存由编译器自动分 配释放，存放函数的参数值，局部变量的值等。其操作方式类似于数据结构中的栈。堆区内存一 般由程序员分配释放，若程序员不释放，程序结束时可能由垃圾回收机制回收。